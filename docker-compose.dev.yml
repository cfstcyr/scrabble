version: '3.3'

services:
    nginx:
        image: nginx
        depends_on:
            - server
            - client
        volumes:
            - ./conf/nginx/dev.d/:/etc/nginx/conf.d
        ports:
            - ${NGINX_PORT:-80}:80

    server:
        image: log3990-server:dev
        build:
            context: ./packages/server
            target: dev
        volumes:
            - ./packages/server:/var/www/app
        ports:
            - ${SERVER_PORT:-3000}:3000
        environment:
            PG_HOST: postgres
            PG_PORT: 5432
            PG_USER: root
            PG_PASSWORD: root
            PG_DATABASE: scrabble
            SERVER_URL: http://server:${SERVER_PORT:-3000}/api

    client:
        image: log3990-client:dev
        build:
            context: ./packages/client
            target: dev
        volumes:
            - ./packages/client:/var/www/app
        ports:
            - ${CLIENT_PORT:-4200}:4200

    postgres:
        image: postgres
        restart: always
        ports:
            - ${PG_PORT:-5432}:5432
        environment:
            POSTGRES_USER: root
            POSTGRES_PASSWORD: root
            POSTGRES_DB: scrabble
